---
import { contentfulClient } from "../../lib/contentful";
import { documentToHtmlString } from "@contentful/rich-text-html-renderer";
import type { BlogPost } from "../../lib/contentful";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const entries = await contentfulClient.getEntries<BlogPost>({
    content_type: "blogPost",
    order: "-sys.createdAt",
  });

  const pages = entries.items.map((item) => ({
    params: { slug: item.fields.slug },
    props: {
      title: item.fields?.title,
      content: documentToHtmlString(item?.fields?.content),
      date: new Date(item?.fields.date).toDateString(),
      excerpt: item.fields?.excerpt,
      slug: item.fields?.slug,
      image: item.fields?.image?.fields?.file?.url,
    },
  }));
  return pages;
}

const { content, title, date, excerpt, slug, image } = Astro.props;
---

<Layout title={title}>
  <div class="container mx-auto px-5">
    <article
      class="py-28 flex flex-col items-start prose prose-invert mx-auto max-w-4xl"
    >
      <h1 class="text-4xl xl:text-5xl font-black">{title}</h1>

      <span class="mt-4">{date}</span>

      <img src={image} alt="" class="max-w-3xl mt-8 w-full" />

      <div class="" set:html={content} />
    </article>
  </div>
</Layout>
